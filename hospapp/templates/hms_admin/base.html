{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>{% block title %}HMS | Administration{% endblock %}</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Local CSS Files -->
    <link rel="stylesheet" href="{% static 'plugins/fontawesome-free/css/all.min.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/ionicons/css/ionicons.min.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/bootstrap-icons/bootstrap-icons.css' %}">
    <link rel="stylesheet" href="{% static 'dist/css/adminlte.min.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/datatables-bs4/css/dataTables.bootstrap4.min.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/datatables-responsive/css/responsive.bootstrap4.min.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/datatables-buttons/css/buttons.bootstrap4.min.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/select2/css/select2.min.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/daterangepicker/daterangepicker.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/icheck-bootstrap/icheck-bootstrap.min.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/bootstrap-colorpicker/css/bootstrap-colorpicker.min.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/bootstrap4-duallistbox/bootstrap-duallistbox.min.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/bs-stepper/css/bs-stepper.min.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/dropzone/min/dropzone.min.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/overlayScrollbars/css/OverlayScrollbars.min.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/sweetalert2-theme-bootstrap-4/bootstrap-4.min.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/toastr/toastr.min.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/jqvmap/jqvmap.min.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/summernote/summernote-bs4.min.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/codemirror/codemirror.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/codemirror/theme/monokai.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/simplemde/simplemde.min.css' %}">
    <link rel="stylesheet" href="{% static 'dist/css/alt/adminlte.extra-components.min.css' %}">
    <link rel="stylesheet" href="{% static 'dist/css/alt/adminlte.components.min.css' %}">
    <link rel="stylesheet" href="{% static 'dist/css/alt/adminlte.pages.min.css' %}">
    <link rel="stylesheet" href="{% static 'dist/css/alt/adminlte.plugins.min.css' %}">
    <link rel="stylesheet" href="{% static 'dist/css/alt/adminlte.light.min.css' %}">
    <link rel="stylesheet" href="{% static 'dist/css/alt/adminlte.dark.min.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/fullcalendar/main.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/ekko-lightbox/ekko-lightbox.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/flag-icon-css/css/flag-icon.min.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/pace-progress/themes/black/pace-theme-flat-top.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/bootstrap-switch/css/bootstrap3/bootstrap-switch.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/jscolor/jscolor.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/chart.js/Chart.min.css' %}">
    <link rel="stylesheet" href="{% static 'plugins/uplot/uPlot.min.css' %}">
    
    <!-- Google Fonts - Local version -->
    <link rel="stylesheet" href="{% static 'fonts/source-sans-pro/source-sans-pro.css' %}">

    {% comment %} This block was added in the previous turn and is retained to allow for extra CSS. {% endcomment %}
    {% block extra_css %}
    <style>
        .user-panel .image img {
            width: 48px; /* Fixed width for the profile picture */
            height: 48px; /* Fixed height for the profile picture */
            object-fit: cover; /* Ensures the image covers the area without distortion, cropping if necessary */
        }
    </style>
    {% endblock %}
</head>

<body class="hold-transition sidebar-mini sidebar-collapse">
    <div class="wrapper">
        <nav class="main-header navbar navbar-expand navbar-white navbar-light">
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
                </li>
                <li class="nav-item d-none d-sm-inline-block">
                    <a href="{% url 'hms_admin' %}" class="nav-link">Home (Admin)</a>
                </li>
            </ul>

            <ul class="navbar-nav ml-auto">
                <li class="nav-item">
                    <span class="nav-link text-muted">
                        <i class="fas fa-user-md mr-1"></i>
                        {{ user.get_full_name|default:user.username }}
                    </span>
                </li>
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'logout' %}" title="Logout">
                        <i class="fas fa-sign-out-alt"></i>
                    </a>
                </li>
            </ul>
        </nav>
        <aside class="main-sidebar sidebar-dark-primary elevation-4">
            <a href="{% url 'hms_admin' %}" class="brand-link">
                <img src="{% static 'dist/img/ayologo.jpg' %}" alt="HMS Logo"
                     class="brand-image img-circle elevation-3" style="opacity: .8">
                <span class="brand-text font-weight-medium text-uppercase">Administration</span>
            </a>

            <div class="sidebar">
                <div class="mt-3 mb-3">
                    <img src="{% static 'dist/img/header.jpg' %}" alt="Header Image" class="img-fluid rounded">
                </div>

                <div class="user-panel mt-3 pb-3 mb-3 d-flex">
                    <div class="image">
                        {% if user.staff.photo %}
                        <img src="{{ user.staff.photo.url }}" class="img-circle elevation-2" alt="{{ user.get_full_name|default:user.username }}">
                        {% else %}
                        <img src="{% static 'dist/img/user2-160x160.jpg' %}" class="img-circle elevation-2" alt="User Image">
                        {% endif %}
                    </div>
                    <div class="info">
                        <span class="d-block text-white">{{ user.get_full_name|default:user.username }}</span>
                        <small class="text-muted text-capitalize">{{ user.staff.role }}</small>
                    </div>
                </div>

                <nav class="mt-0">
                    <ul class="nav nav-pills nav-sidebar flex-column" data-widget="treeview" role="menu" data-accordion="false">
                        <li class="nav-item">
                            <a href="{% url 'hms_admin' %}" class="nav-link {% if request.resolver_match.url_name == 'hms_admin' %}active{% endif %}">
                                <i class="nav-icon fas fa-tachometer-alt"></i>
                                <p>Dashboard (Admin)</p>
                            </a>
                        </li>

                        <li class="nav-item">
                            <a href="{% url 'director_operations' %}" class="nav-link {% if request.resolver_match.url_name == 'director_operations' %}active{% endif %}">
                                <i class="nav-icon fas fa-cogs"></i>
                                <p>Operations & Approvals</p>
                            </a>
                        </li>

                        <li class="nav-item">
                            <a href="{% url 'director_reports' %}" class="nav-link {% if request.resolver_match.url_name == 'director_reports' %}active{% endif %}">
                                <i class="nav-icon fas fa-file-alt"></i>
                                <p>Full Reports</p>
                            </a>
                        </li>

                        <li class="nav-item">
                            <a href="{% url 'user_accounts' %}" class="nav-link {% if request.resolver_match.url_name == 'user_accounts' %}active{% endif %}">
                                <i class="nav-icon fas fa-user-cog"></i>
                                <p>User Management</p>
                            </a>
                        </li>

                        <li class="nav-header">DEPARTMENT REPORTS</li>

                        <li class="nav-item">
                            <a href="{% url 'doctor_reports' %}" class="nav-link {% if request.resolver_match.url_name == 'doctor_reports' %}active{% endif %}">
                                <i class="nav-icon fas fa-user-md"></i>
                                <p>Doctor Station Reports</p>
                            </a>
                        </li>

                        <li class="nav-item">
                            <a href="{ url 'receptionist_reports' %}" class="nav-link {% if request.resolver_match.url_name == 'receptionist_reports' %}active{% endif %}">
                                <i class="nav-icon fas fa-user-tie"></i>
                                <p>Receptionist Reports</p>
                            </a>
                        </li>

                        <li class="nav-item">
                            <a href="{ url 'nursing_reports' %}" class="nav-link {% if request.resolver_match.url_name == 'nursing_reports' %}active{% endif %}">
                                <i class="nav-icon fas fa-user-nurse"></i>
                                <p>Nursing Station Reports</p>
                            </a>
                        </li>

                        <li class="nav-item">
                            <a href="{ url 'lab_reports' %}" class="nav-link {% if request.resolver_match.url_name == 'lab_reports' %}active{% endif %}">
                                <i class="nav-icon fas fa-vial"></i>
                                <p>Lab Station Reports</p>
                            </a>
                        </li>

                        <li class="nav-item">
                            <a href="{ url 'accounts_reports' %}" class="nav-link {% if request.resolver_match.url_name == 'accounts_reports' %}active{% endif %}">
                                <i class="nav-icon fas fa-wallet"></i>
                                <p>Accounts Department Reports</p>
                            </a>
                        </li>

                        <li class="nav-item">
                            <a href="{ url 'hr_reports' %}" class="nav-link {% if request.resolver_match.url_name == 'hr_reports' %}active{% endif %}">
                                <i class="nav-icon fas fa-users"></i>
                                <p>Human Resources Reports</p>
                            </a>
                        </li>

                        <li class="nav-header">ACCOUNT</li>
                        <li class="nav-item">
                            <a href="{% url 'logout' %}" class="nav-link">
                                <i class="nav-icon fas fa-sign-out-alt text-danger"></i>
                                <p>Logout</p>
                            </a>
                        </li>
                    </ul>
                </nav>
                </div>
            </aside>

        <div class="content-wrapper">
            {% block content %}

            {% endblock %}
        </div>
        <div aria-live="polite" aria-atomic="true" style="position: fixed; top: 1rem; right: 1rem; z-index: 1080;">
            <div id="toast-container">
                {% if messages %}
                {% for message in messages %}
                <div class="toast bg-{{ message.tags|default:"info" }} text-white mb-3" role="alert" data-delay="5000" data-autohide="true">
                    <div class="toast-header bg-{{ message.tags|default:"info" }} text-white border-0">
                        <i class="mr-2 fas fa-{{
                            "check-circle" if message.tags == "success"
                            else "exclamation-triangle" if message.tags == "warning"
                            else "times-circle" if message.tags == "error"
                            else "info-circle"
                            }}"></i>
                        <strong class="mr-auto text-capitalize">{{ message.tags|default:"Info" }}</strong>
                        <button type="button" class="ml-2 mb-1 close text-white" data-dismiss="toast" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="toast-body">
                        {{ message }}
                    </div>
                </div>
                {% endfor %}
                {% endif %}
            </div>
        </div>

        <div id="notification-bell" style="position: fixed; top: 50%; right: 0; z-index: 1050; display: none;">
            <button class="btn btn-warning rounded-circle p-3 shadow" id="toggleNotifications">
                <i class="fas fa-bell fa-lg"></i>
                <span id="notification-count" class="badge badge-danger badge-pill position-absolute" style="top: -5px; right: -5px; display: none;">0</span>
            </button>
        </div>

        <div id="notification-panel" class="card shadow-lg" style="position: fixed; top: 50%; right: 70px; transform: translateY(-50%); width: 320px; display: none; z-index: 1040; max-height: 400px;">
            <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
                <h6 class="mb-0">
                    <i class="fas fa-bell mr-2"></i>
                    Notifications
                </h6>
                <button type="button" class="btn btn-sm btn-outline-light" id="closeNotifications">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="card-body p-0" style="max-height: 300px; overflow-y: auto;">
                <ul class="list-group list-group-flush" id="notificationList">
                    </ul>
            </div>
        </div>

        <footer class="main-footer">
            <div class="float-right d-none d-sm-block">
                <b>Version</b> 1.0.0
            </div>
            <strong>Hospital Management System &copy; {% now "Y" %}.</strong> All rights reserved.
        </footer>

        <aside class="control-sidebar control-sidebar-dark">
            </aside>
        </div>

    <!-- Local JavaScript Files -->
    <script src="{% static 'plugins/jquery/jquery.min.js' %}"></script>
    <script src="{% static 'plugins/jquery-ui/jquery-ui.min.js' %}"></script>
    <script src="{% static 'plugins/bootstrap/js/bootstrap.bundle.min.js' %}"></script>
    <script src="{% static 'plugins/datatables/jquery.dataTables.min.js' %}"></script>
    <script src="{% static 'plugins/datatables-bs4/js/dataTables.bootstrap4.min.js' %}"></script>
    <script src="{% static 'plugins/datatables-responsive/js/dataTables.responsive.min.js' %}"></script>
    <script src="{% static 'plugins/datatables-responsive/js/responsive.bootstrap4.min.js' %}"></script>
    <script src="{% static 'plugins/datatables-buttons/js/dataTables.buttons.min.js' %}"></script>
    <script src="{% static 'plugins/datatables-buttons/js/buttons.bootstrap4.min.js' %}"></script>
    <script src="{% static 'plugins/jszip/jszip.min.js' %}"></script>
    <script src="{% static 'plugins/pdfmake/pdfmake.min.js' %}"></script>
    <script src="{% static 'plugins/pdfmake/vfs_fonts.js' %}"></script>
    <script src="{% static 'plugins/datatables-buttons/js/buttons.html5.min.js' %}"></script>
    <script src="{% static 'plugins/datatables-buttons/js/buttons.print.min.js' %}"></script>
    <script src="{% static 'plugins/datatables-buttons/js/buttons.colVis.min.js' %}"></script>
    <script src="{% static 'plugins/select2/js/select2.full.min.js' %}"></script>
    <script src="{% static 'plugins/moment/moment.min.js' %}"></script>
    <script src="{% static 'plugins/daterangepicker/daterangepicker.js' %}"></script>
    <script src="{% static 'plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js' %}"></script>
    <script src="{% static 'plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.min.js' %}"></script>
    <script src="{% static 'plugins/bootstrap4-duallistbox/jquery.bootstrap-duallistbox.min.js' %}"></script>
    <script src="{% static 'plugins/inputmask/jquery.inputmask.min.js' %}"></script>
    <script src="{% static 'plugins/bs-stepper/js/bs-stepper.min.js' %}"></script>
    <script src="{% static 'plugins/dropzone/min/dropzone.min.js' %}"></script>
    <script src="{% static 'plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js' %}"></script>
    <script src="{% static 'plugins/sweetalert2/sweetalert2.min.js' %}"></script>
    <script src="{% static 'plugins/toastr/toastr.min.js' %}"></script>
    <script src="{% static 'plugins/jqvmap/jquery.vmap.min.js' %}"></script>
    <script src="{% static 'plugins/jqvmap/maps/jquery.vmap.usa.js' %}"></script>
    <script src="{% static 'plugins/sparklines/sparkline.js' %}"></script>
    <script src="{% static 'plugins/summernote/summernote-bs4.min.js' %}"></script>
    <script src="{% static 'plugins/codemirror/codemirror.js' %}"></script>
    <script src="{% static 'plugins/codemirror/mode/css/css.js' %}"></script>
    <script src="{% static 'plugins/codemirror/mode/xml/xml.js' %}"></script>
    <script src="{% static 'plugins/codemirror/mode/htmlmixed/htmlmixed.js' %}"></script>
    <script src="{% static 'plugins/simplemde/simplemde.min.js' %}"></script>
    <script src="{% static 'plugins/fullcalendar/main.js' %}"></script>
    <script src="{% static 'plugins/bootstrap-switch/js/bootstrap-switch.min.js' %}"></script>
    <script src="{% static 'plugins/ekko-lightbox/ekko-lightbox.min.js' %}"></script>
    <script src="{% static 'plugins/filterizr/jquery.filterizr.min.js' %}"></script>
    <script src="{% static 'plugins/pace-progress/pace.min.js' %}"></script>
    <script src="{% static 'plugins/bootstrap-slider/bootstrap-slider.min.js' %}"></script>
    <script src="{% static 'plugins/ion-rangeslider/js/ion.rangeSlider.min.js' %}"></script>
    <script src="{% static 'plugins/bootstrap-colorpicker/js/bootstrap-colorpicker.min.js' %}"></script>
    <script src="{% static 'plugins/jscolor/jscolor.min.js' %}"></script>
    <script src="{% static 'plugins/jquery-knob/jquery.knob.min.js' %}"></script>
    <script src="{% static 'plugins/chart.js/Chart.min.js' %}"></script>
    <script src="{% static 'plugins/flot/jquery.flot.js' %}"></script>
    <script src="{% static 'plugins/flot/plugins/jquery.flot.resize.js' %}"></script>
    <script src="{% static 'plugins/flot/plugins/jquery.flot.pie.js' %}"></script>
    <script src="{% static 'plugins/uplot/uPlot.iife.min.js' %}"></script>
    <script src="{% static 'dist/js/adminlte.min.js' %}"></script>
    <script src="{% static 'dist/js/demo.js' %}"></script>

    <script>
        //Select2
        $(function () {
            //Initialize Select2 Elements
            $('.select2').select2()

            //Initialize Select2 Elements
            $('.select2bs4').select2({
                theme: 'bootstrap4'
            })
        });
    </script>
    {% block extra_js%}

    {% endblock %}

    <script>
        $(function () {
            $("#example1").DataTable({
                "responsive": true,
                "lengthChange": false,
                "autoWidth": false,
                "buttons": ["copy", "csv", "excel", "pdf", "print", "colvis"]
            }).buttons().container().appendTo('#example1_wrapper .col-md-6:eq(0)');

            $('#example2').DataTable({
                "paging": true,
                "lengthChange": false,
                "searching": false,
                "ordering": true,
                "info": true,
                "autoWidth": false,
                "responsive": true,
            });
        });
    </script>

    <script>
        $(document).ready(function () {
            // Initialize toast notifications
            $('.toast').toast('show');
        });
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const hash = window.location.hash;
            if (hash) {
                const tabTrigger = document.querySelector(`a[href="${hash}"]`);
                if (tabTrigger) {
                    $(tabTrigger).tab('show');
                }
            }

            // Update hash on tab click
            $('a[data-toggle="tab"]').on('shown.bs.tab', function (e) {
                history.replaceState(null, null, e.target.hash);
            });
        });
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const toggleBtn = document.getElementById("toggleNotifications");
            const closeBtn = document.getElementById("closeNotifications");
            const panel = document.getElementById("notification-panel");
            const list = document.getElementById("notificationList");
            const bell = document.getElementById("notification-bell");
            const countBadge = document.getElementById("notification-count");

            // Function to fetch and update notifications
            function loadNotifications() {
                fetch('/notifications/data/')
                    .then(response => response.json())
                    .then(data => {
                        const notifications = data.notifications;
                        const totalCount = notifications.reduce((sum, item) => sum + item.count, 0);
                        const hasNotifications = totalCount > 0;

                        // Show/hide bell icon based on notification count
                        bell.style.display = hasNotifications ? "block" : "none";

                        // Update count badge
                        if (totalCount > 0) {
                            countBadge.textContent = totalCount > 99 ? '99+' : totalCount;
                            countBadge.style.display = "block";
                        } else {
                            countBadge.style.display = "none";
                        }

                        // Populate notification panel
                        list.innerHTML = "";
                        if (notifications.length === 0) {
                            const li = document.createElement("li");
                            li.className = "list-group-item text-center text-muted";
                            li.innerHTML = '<i class="fas fa-bell-slash mr-2"></i>No notifications';
                            list.appendChild(li);
                        } else {
                            notifications.forEach(item => {
                                const li = document.createElement("li");
                                li.className = "list-group-item d-flex justify-content-between align-items-center";
                                li.innerHTML = `
                                            <div class="d-flex align-items-center">
                                                <i class="fas fa-circle text-primary mr-2" style="font-size: 6px;"></i>
                                                <span>${item.title}</span>
                                            </div>
                                            <span class="badge badge-primary badge-pill">${item.count}</span>
                                        `;
                                li.style.cursor = "pointer";
                                li.onclick = () => {
                                    window.location.href = item.url;
                                    panel.style.display = "none";
                                };

                                // Add hover effect
                                li.addEventListener('mouseenter', function () {
                                    this.style.backgroundColor = '#f8f9fa';
                                });
                                li.addEventListener('mouseleave', function () {
                                    this.style.backgroundColor = '';
                                });

                                list.appendChild(li);
                            });
                        }
                    })
                    .catch(err => {
                        console.error("Notification fetch error:", err);
                        list.innerHTML = '<li class="list-group-item text-center text-danger"><i class="fas fa-exclamation-triangle mr-2"></i>Error loading notifications</li>';
                    });
            }

            // Initial fetch
            loadNotifications();

            // Refresh notifications every 10 seconds
            setInterval(loadNotifications, 10000);

            // Toggle panel visibility
            toggleBtn.addEventListener("click", () => {
                panel.style.display = panel.style.display === "none" ? "block" : "none";
            });

            // Close panel
            closeBtn.addEventListener("click", () => {
                panel.style.display = "none";
            });

            // Close panel when clicking outside
            document.addEventListener("click", (e) => {
                if (!panel.contains(e.target) && !toggleBtn.contains(e.target)) {
                    panel.style.display = "none";
                }
            });
        });
    </script>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const printButton = document.querySelector(".btn.btn-secondary.no-print");

            if (printButton) {
                printButton.addEventListener("click", function (e) {
                    e.preventDefault();

                    // Get patient name for file naming
                    const patientName = "{{ patient.full_name }}";
                    const sanitizedName = patientName.replace(/[^a-zA-Z0-9]/g, '_');
                    const fileName = `Test_Results_${sanitizedName}_${new Date().toISOString().split('T')[0]}`;

                    // Create print content
                    const printContent = document.getElementById("print-area").innerHTML;

                    const printWindow = window.open('', '_blank', 'width=800,height=600');
                    printWindow.document.title = fileName;
                    printWindow.document.write(`
                        <!DOCTYPE html>
                        <html>
                        <head>
                            <title>${fileName}</title>
                            <link rel="stylesheet" href="{% static 'dist/css/adminlte.min.css' %}">
                            <link rel="stylesheet" href="{% static 'plugins/fontawesome-free/css/all.min.css' %}">
                            <style>
                                body {
                                    font-family: 'Source Sans Pro', sans-serif;
                                    padding: 20px;
                                    background: white;
                                    color: #333;
                                }
                                .card {
                                    margin-bottom: 20px;
                                    border: 1px solid #ddd;
                                    border-radius: 5px;
                                }
                                .card-header {
                                    background-color: #f8f9fa;
                                    padding: 10px 15px;
                                    border-bottom: 1px solid #ddd;
                                    font-weight: bold;
                                }
                                .card-body {
                                    padding: 15px;
                                }
                                .table {
                                    width: 100%;
                                    border-collapse: collapse;
                                    margin-bottom: 15px;
                                }
                                .table th, .table td {
                                    border: 1px solid #ddd;
                                    padding: 8px;
                                    text-align: left;
                                }
                                .table th {
                                    background-color: #f8f9fa;
                                    font-weight: bold;
                                }
                                .no-print, .content-header {
                                    display: none !important;
                                }
                                .img-circle {
                                    border-radius: 50%;
                                }
                                h1, h3, h5 {
                                    color: #333;
                                }
                                .text-center {
                                    text-align: center;
                                }
                                .text-right {
                                    text-align: right;
                                }
                                .text-left {
                                    text-align: left;
                                }
                                .badge {
                                    display: inline-block;
                                    padding: 0.25em 0.4em;
                                    font-size: 75%;
                                    font-weight: 700;
                                    line-height: 1;
                                    text-align: center;
                                    white-space: nowrap;
                                    vertical-align: baseline;
                                    border-radius: 0.25rem;
                                }
                                .badge-success {
                                    color: #fff;
                                    background-color: #28a745;
                                }
                                .badge-warning {
                                    color: #212529;
                                    background-color: #ffc107;
                                }
                                .badge-danger {
                                    color: #fff;
                                    background-color: #dc3545;
                                }
                                .badge-info {
                                    color: #fff;
                                    background-color: #17a2b8;
                                }
                                @media print {
                                    .no-print {
                                        display: none !important;
                                    }
                                    body {
                                        margin: 0;
                                        padding: 15px;
                                    }
                                    .card {
                                        page-break-inside: avoid;
                                        margin-bottom: 10px;
                                    }
                                    .table {
                                        page-break-inside: auto;
                                    }
                                    .table tr {
                                        page-break-inside: avoid;
                                        page-break-after: auto;
                                    }
                                }
                            </style>
                        </head>
                        <body>
                            ${printContent}
                        </body>
                        </html>
                    `);

                    printWindow.document.close();
                    
                    // Wait for content to load then print
                    printWindow.onload = function() {
                        printWindow.focus();
                        printWindow.print();
                        printWindow.close();
                    };
                });
            }
        });
    </script>

    <script>
        // Additional utility functions for the HMS system
        function confirmAction(message, callback) {
            if (confirm(message)) {
                callback();
            }
        }

        function showAlert(message, type = 'info') {
            const alertClass = type === 'success' ? 'alert-success' : 
                              type === 'warning' ? 'alert-warning' : 
                              type === 'error' ? 'alert-danger' : 'alert-info';
            
            const alertDiv = `
                <div class="alert ${alertClass} alert-dismissible fade show" role="alert">
                    ${message}
                    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
            `;
            
            // Insert alert at the top of content wrapper
            const contentWrapper = document.querySelector('.content-wrapper');
            if (contentWrapper) {
                contentWrapper.insertAdjacentHTML('afterbegin', alertDiv);
            }
        }

        // Form validation helper
        function validateForm(formId) {
            const form = document.getElementById(formId);
            if (!form) return false;
            
            const requiredFields = form.querySelectorAll('[required]');
            let isValid = true;
            
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    field.classList.add('is-invalid');
                    isValid = false;
                } else {
                    field.classList.remove('is-invalid');
                }
            });
            
            return isValid;
        }

        // Auto-refresh functionality for certain pages
        function autoRefresh(interval = 60000) {
            setInterval(() => {
                // Only refresh if user is active (not idle)
                if (document.hasFocus()) {
                    location.reload();
                }
            }, interval);
        }

        // Initialize tooltips
        $(function () {
            $('[data-toggle="tooltip"]').tooltip();
        });

        // Initialize popovers
        $(function () {
            $('[data-toggle="popover"]').popover();
        });
    </script>

    {% block extra_footer_js %}
    {% endblock %}

</body>
</html>