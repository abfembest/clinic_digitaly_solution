{% extends "doctors/base.html" %}

{% block title %}HMS | Doctor Home{% endblock %}
{% block content %}

{% include 'dashboardstyle.css' %}

<div class="container py-5">
    <div class="dashboard-header mb-4">
        <div class="d-flex justify-content-between align-items-center">
            <div>
                <h1 class="mb-0">Doctor's Dashboard</h1>
                <p class="mb-0 opacity-75">Fertility Clinic Management System</p>
            </div>
            <div class="text-end">
                <p class="mb-0"><i class="bi bi-calendar3"></i> {% now "l, F j, Y" %}</p>
                <p class="mb-0"><i class="bi bi-person-circle"></i> Dr. {{ user.username }}</p>
            </div>
        </div>
    </div>


    <div class="row g-4">
        <div class="col-md-6 col-lg-4">
            <div class="card card-feature">
                <div class="card-body d-flex flex-column justify-content-between py-4">
                    <div>
                        <div class="icon-container bg-patient">
                            <i class="bi bi-journal-medical"></i>
                        </div>
                        <h5 class="card-title">Patient Records</h5>
                        <p class="card-text">Review consultation notes, medical history, and laboratory results for your
                            patients.</p>
                    </div>
                    <div class="mt-3">
                        <div class="d-flex justify-content-center gap-2">
                            <span class="badge bg-info">{{ new_results_count }} New Results</span>
                            <span class="badge bg-warning text-dark">{{ pending_reviews_count }} Pending Reviews</span>
                        </div>
                    </div>
                </div>
                <div class="card-footer py-3">
                    <a href="{% url 'access_medical_records' %}" class="action-link">Access Patient Records <i
                            class="bi bi-arrow-right"></i></a>
                </div>
            </div>
        </div>

        <div class="col-md-6 col-lg-4">
            <div class="card card-feature">
                <div class="card-body d-flex flex-column justify-content-between py-4">
                    <div>
                        <div class="icon-container bg-diagnose">
                            <i class="bi bi-user-md"></i>
                        </div>
                        <h5 class="card-title">Patient Consultation</h5>
                        <p class="card-text">Conduct patient consultations and provide medical advice based on patient
                            assessments.</p>
                    </div>
                    <div class="mt-3">
                        <div class="d-flex justify-content-center gap-2">
                            <span class="badge bg-primary">{{ waiting_assessment_count }} Waiting Assessment</span>
                            <span class="badge bg-success">{{ completed_today_count }} Completed Today</span>
                        </div>
                    </div>
                </div>
                <div class="card-footer py-3">
                    <a href="{% url 'doctor_consultation' %}" class="action-link">Start Consultation <i
                            class="bi bi-arrow-right"></i></a>
                </div>
            </div>
        </div>

        <div class="col-md-4 col-lg-4">
            <div class="card card-feature">
                <div class="card-body d-flex flex-column justify-content-between py-4">
                    <div>
                        <div class="icon-container bg-prescribe">
                            <i class="bi bi-vial"></i>
                        </div>
                        <h5 class="card-title">Request Test</h5>
                        <p class="card-text">Request laboratory tests and diagnostic procedures for your patients.</p>
                    </div>
                    <div class="mt-3">
                        <div class="d-flex justify-content-center gap-2">
                            <span class="badge bg-warning text-dark">{{ pending_requests_count }} Pending Requests</span>
                            <span class="badge bg-success">{{ total_tests_requested_count }} Tests Requested</span>
                        </div>
                    </div>
                </div>
                <div class="card-footer py-3">
                    <a href="{% url 'requesttest' %}" class="action-link">Request Test <i
                            class="bi bi-arrow-right"></i></a>
                </div>
            </div>
        </div>

        <div class="col-md-6 col-lg-4">
            <div class="card card-feature">
                <div class="card-body d-flex flex-column justify-content-between py-4">
                    <div>
                        <div class="icon-container bg-tests">
                            <i class="bi bi-flask"></i>
                        </div>
                        <h5 class="card-title">Recommended Tests</h5>
                        <p class="card-text">View and manage recommended diagnostic tests and laboratory procedures.</p>
                    </div>
                    <div class="mt-3">
                        <div class="d-flex justify-content-center gap-2">
                            <span class="badge bg-secondary">{{ recommendations_count }} Recommendations</span>
                            <span class="badge bg-info">{{ available_results_count }} Results Available</span>
                        </div>
                    </div>
                </div>
                <div class="card-footer py-3">
                    <a href="{% url 'recomended_tests' %}" class="action-link">View Recommendations <i
                            class="bi bi-arrow-right"></i></a>
                </div>
            </div>
        </div>

        <div class="col-md-6 col-lg-4">
            <div class="card card-feature">
                <div class="card-body d-flex flex-column justify-content-between py-4">
                    <div>
                        <div class="icon-container bg-monitor">
                            <i class="bi bi-bar-chart"></i>
                        </div>
                        <h5 class="card-title">Reports and Data</h5>
                        <p class="card-text">Access comprehensive reports and analytical data for patient management. </p>
                    </div>
                    <div class="mt-3">
                        <div class="d-flex justify-content-center gap-2">
                            <span class="badge bg-primary">{{ reports_available_count }} Reports Available</span>
                            <span class="badge bg-success">{{ updated_today_count }} Updated Today</span>
                        </div>
                    </div>
                </div>
                <div class="card-footer py-3">
                    <a href="{% url 'doctor_report' %}" class="action-link">View Reports <i
                            class="bi bi-arrow-right"></i></a>
                </div>
            </div>
        </div>
    </div> <div class="container py-5">
        <div class="card shadow-lg">
            <div class="card-body">
                <h4 class="text-center">Activities Chart</h4>
                <div class="row">
                    <div class="col-md-6">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title text-center">Patient Admissions (Last 7 Days)</h5>
                                <canvas id="requestedtest" height="100"></canvas>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="card shadow-sm">
                            <div class="card-body">
                                <h5 class="card-title text-center">Test Completed (Last 7 Days)</h5>
                                <canvas id="completedChart" height="100"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
    // Data from Django context
    const admissionsData = {{ admissions_data|safe }};
    const testsCompletedData = {{ tests_completed_data|safe }};

    // Prepare labels and data for the charts
    const admissionsLabels = admissionsData.map(item => item.admitted_on);
    const admissionsCounts = admissionsData.map(item => item.count);

    const testsLabels = testsCompletedData.map(item => item.date_performed__date);
    const testsCounts = testsCompletedData.map(item => item.count);
    
    // Create the charts using Chart.js
    document.addEventListener('DOMContentLoaded', function() {
        // Patient Admissions Chart
        const admissionsCtx = document.getElementById('requestedtest').getContext('2d');
        const admissionsChart = new Chart(admissionsCtx, {
            type: 'bar',
            data: {
                labels: admissionsLabels,
                datasets: [{
                    label: '# of Admissions',
                    data: admissionsCounts,
                    backgroundColor: 'rgba(54, 162, 235, 0.5)',
                    borderColor: 'rgba(54, 162, 235, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
        
        // Tests Completed Chart
        const completedCtx = document.getElementById('completedChart').getContext('2d');
        const completedChart = new Chart(completedCtx, {
            type: 'line',
            data: {
                labels: testsLabels,
                datasets: [{
                    label: '# of Tests Completed',
                    data: testsCounts,
                    backgroundColor: 'rgba(75, 192, 192, 0.5)',
                    borderColor: 'rgba(75, 192, 192, 1)',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
    });
    </script>
{% endblock %}